# Конфигурация ресурсов для Checkpoint System

## Общая конфигурация сервера
- **CPU**: 2 ядра
- **RAM**: 768 MB
- **OS**: Ubuntu 24.04
- **Go Version**: 1.23 (оптимизированная сборка)

## Распределение ресурсов по контейнерам

### 1. KeyDB (База данных)
- **CPU Limit**: 0.5 ядра (50%)
- **CPU Reservation**: 0.2 ядра (20%)
- **Memory Limit**: 150 MB
- **Memory Reservation**: 100 MB
- **Max Memory**: 128 MB (в конфигурации KeyDB)
- **Назначение**: Хранение данных о пунктах пропуска

### 2. API (Веб-сервер)
- **CPU Limit**: 0.8 ядра (80%)
- **CPU Reservation**: 0.3 ядра (30%)
- **Memory Limit**: 200 MB
- **Memory Reservation**: 100 MB
- **Назначение**: REST API для доступа к данным

### 3. Parser (Парсер данных)
- **CPU Limit**: 0.4 ядра (40%)
- **CPU Reservation**: 0.1 ядра (10%)
- **Memory Limit**: 150 MB
- **Memory Reservation**: 50 MB
- **Назначение**: Парсинг и обновление данных

### 4. Nginx (Прокси-сервер)
- **CPU Limit**: 0.3 ядра (30%)
- **CPU Reservation**: 0.1 ядра (10%)
- **Memory Limit**: 100 MB
- **Memory Reservation**: 50 MB
- **Назначение**: Проксирование запросов и балансировка

## Итого используемых ресурсов

### CPU
- **Максимум**: 2.0 ядра (100% от доступных)
- **Резервация**: 0.7 ядра (35% от доступных)

### Memory
- **Максимум**: 600 MB (78% от доступных)
- **Резервация**: 300 MB (39% от доступных)

## Оптимизации

### KeyDB
- Уменьшен `maxmemory` до 128 MB
- Используется политика `allkeys-lru` для освобождения памяти
- Оптимизированы настройки persistence

### Nginx
- Уменьшено количество `worker_connections` до 256
- Уменьшены зоны rate limiting до 1MB
- Включен `epoll` для эффективной работы

### API
- **Go 1.23**: Использована последняя версия Go с улучшенной производительностью
- **Оптимизированная сборка**: Флаги `-ldflags="-w -s -extldflags '-static'" -trimpath` для минимального размера
- **Статическая линковка**: Полностью автономный бинарник без внешних зависимостей
- **Уменьшенный размер**: Оптимизированы логи и убрана отладочная информация

### Общие
- Уменьшены размеры логов до 5MB с 2 файлами
- Все контейнеры используют `restart: unless-stopped`

## Мониторинг

Для мониторинга ресурсов используйте:
```bash
./monitor_resources.sh
```

## Рекомендации

1. **Мониторинг**: Регулярно проверяйте использование ресурсов
2. **Масштабирование**: При необходимости можно увеличить лимиты для API
3. **Резерв**: Оставлено ~200MB RAM для системы и других процессов
4. **CPU**: Оставлено ~0.3 ядра для системы

## Команды для запуска

```bash
# Запуск системы
cd release
docker-compose -f docker-compose.full.yml -p checkpoint-full up -d

# Мониторинг ресурсов
./monitor_resources.sh

# Остановка системы
docker-compose -f docker-compose.full.yml -p checkpoint-full down
```
